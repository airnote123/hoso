<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ランチタイム放送台本（自動保存・編集ロック機能付き）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        .reading-text {
            line-height: 1.8;
            font-size: 1.1rem;
        }
        /* contenteditable エリアのスタイル */
        .editable-script {
            padding: 1rem;
            border: 2px dashed #d1d5db; /* 灰色の破線 */
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            cursor: text;
        }
        /* 編集可能な時のスタイル */
        .editable-script[contenteditable="true"] {
            border-color: #3b82f6; /* 編集モードは青 */
            box-shadow: 0 0 0 1px #3b82f6;
            background-color: #f7f9ff;
        }
        /* ロックされた時のスタイル */
        .editable-script[contenteditable="false"] {
            cursor: default;
            border-style: solid;
            border-color: #f3f4f6; /* ロックモードは薄い灰色 */
            background-color: #ffffff;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-btn {
            touch-action: manipulation;
            user-select: none;
        }
        /* カスタムメッセージボックス */
        #message-box {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            transition: opacity 0.3s ease-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-2 md:p-8 pb-20">

    <!-- カスタムメッセージボックス -->
    <div id="message-box" class="hidden opacity-0"></div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        <!-- Header -->
        <header class="bg-gray-800 text-white p-4 text-center flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0">
            <h1 class="text-xl md:text-2xl font-bold">ランチタイム放送 デジタル台本</h1>
            <div class="flex space-x-3">
                <!-- 編集ロック/アンロックボタン -->
                <button onclick="toggleEditMode()" id="edit-toggle-btn" class="flex items-center space-x-2 bg-yellow-500 hover:bg-yellow-600 text-gray-900 text-sm font-bold py-2 px-3 rounded-lg transition duration-150 ease-in-out shadow-md">
                    <svg id="lock-icon" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 12a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057 .458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                    </svg>
                    <svg id="pen-icon" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-5.464 5.464a1 1 0 000 1.414l.707.707L11.5 8.707l-.707-.707a1 1 0 00-1.414 0z" />
                        <path fill-rule="evenodd" d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-5.464 5.464a1 1 0 000 1.414l.707.707L11.5 8.707l-.707-.707a1 1 0 00-1.414 0zM12.5 16A3.5 3.5 0 019 12.5v-1a1 1 0 00-2 0v1a5.5 5.5 0 005.5 5.5h1a1 1 0 000-2h-1z" clip-rule="evenodd" />
                    </svg>
                    <span id="edit-status-text">編集する</span>
                </button>

                <!-- コピーボタン -->
                <button onclick="copyScript()" class="flex items-center space-x-2 bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-2 px-3 rounded-lg transition duration-150 ease-in-out shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h6a2 2 0 00-2-2H5z" />
                    </svg>
                    <span>台本をコピー</span>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="flex border-b border-gray-200 bg-gray-50">
            <button onclick="switchTab('broadcast1')" id="btn-broadcast1" class="tab-btn w-1/3 py-4 px-1 text-center font-bold text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors border-b-4 border-transparent">
                <span class="block text-sm md:text-lg">放送 1</span>
                <span class="hidden md:block text-xs font-normal opacity-70">♪ キセキ</span>
            </button>
            <button onclick="switchTab('broadcast2')" id="btn-broadcast2" class="tab-btn w-1/3 py-4 px-1 text-center font-bold text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors border-b-4 border-transparent">
                <span class="block text-sm md:text-lg">放送 2</span>
                <span class="hidden md:block text-xs font-normal opacity-70">♪ エジソン</span>
            </button>
            <button onclick="switchTab('broadcast3')" id="btn-broadcast3" class="tab-btn w-1/3 py-4 px-1 text-center font-bold text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors border-b-4 border-transparent">
                <span class="block text-sm md:text-lg">放送 3</span>
                <span class="hidden md:block text-xs font-normal opacity-70">♪ 家カフェ</span>
            </button>
        </div>

        <!-- Content Container -->
        <div class="p-4 md:p-8 bg-white min-h-[600px]">

            <!-- =========================================
                 放送番号 1 の内容 (給食雑学クイズ)
            ========================================== -->
            <div id="broadcast1" class="script-content fade-in">
                <div class="flex items-center justify-between bg-blue-50 p-3 rounded border-l-4 border-blue-500 mb-6">
                    <h2 class="font-bold text-blue-700">放送日：12月1日（月）</h2>
                    <span class="text-sm text-blue-600">担当：5年 放送委員</span>
                </div>

                <!-- 編集可能なエリア -->
                <div id="editable-broadcast1" contenteditable="false" class="editable-script">
                    <!-- Opening -->
                    <section class="border-l-4 border-blue-500 pl-4 mb-8">
                        <h3 class="text-sm font-bold text-blue-500 uppercase mb-2 tracking-wider">12:35 オープニング</h3>
                        <div class="space-y-4 reading-text">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>全・宝仙小の皆さん、こんにちは！<br>
                                さあ、始まりました！「Lunchtime music」のお時間です！<br>
                                この番組は、皆さんの毎日がさらに楽しくなるように発信する宝仙小ラジオ番組です。</p>
                            </div>
                            <div class="bg-gray-50 p-2 rounded border border-gray-200 text-sm text-gray-600 flex items-center gap-2">
                                <span class="bg-gray-200 px-2 py-0.5 rounded text-xs font-bold">動作</span>
                                CD音量を下げ、BGMとして流す
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>さて「Lunchtime music」始まっていますよ。<br>
                                この番組は、『給食の時間がさらに楽しくなるように』放送委員会がお送りします。</p>
                                <p class="mt-2">それではまず、ジブリ、そして「こたえあわせ」を続けて放送します。**ぜひお楽しみください！**</p>
                            </div>
                        </div>
                    </section>

                    <!-- Pre-Trivia Music Block -->
                    <section class="border-l-4 border-gray-400 pl-4 opacity-70 hover:opacity-100 transition mb-8">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-2 tracking-wider">放送中 (12:35 - 12:43頃)</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 bg-gray-50 p-3 rounded">
                            <li>♪ ジブリ</li>
                            <li>♪ こたえあわせ</li>
                            <li class="font-bold text-blue-600">♪ キセキ（1曲目）</li>
                        </ul>
                    </section>

                    <!-- Trivia Section 1 (給食雑学) -->
                    <section class="border-4 border-yellow-400 rounded-xl overflow-hidden shadow-sm relative mb-8">
                        <div class="bg-yellow-400 text-black font-bold py-2 px-4 flex justify-between items-center">
                            <span>★ ここから「ですます調」モード（敬語なし）</span>
                            <span class="text-xs bg-white text-yellow-800 px-2 py-1 rounded">12:43頃〜</span>
                        </div>
                        <div class="p-6 bg-yellow-50 space-y-6 reading-text">
                            <div>
                                <p class="font-bold text-gray-800 mb-1">放送委員</p>
                                <p class="text-sm text-gray-500 mb-2">（曲「キセキ」終了後、少し間を空けて）</p>
                                <p class="font-bold text-lg">
                                    さあ、ここからは知って楽しい豆知識！<span class="font-bold text-yellow-800">「ランチタイム雑学」</span>のお時間です！<br>
                                    今回のテーマは、<span class="font-bold text-red-700">「給食のふしぎ」</span>です。<br>
                                    さっそく、給食の時間がもっと楽しくなるクイズに挑戦してみましょう！
                                </p>
                            </div>

                            <!-- Q1 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第1問：給食の始まり</span>
                                    <p class="font-bold text-red-700">問題です！日本の給食が始まったのは、どんな目的からだったでしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. たくさんの料理を効率よく作る練習のため</p>
                                        <p>2. 貧しい子どもたちへの支援のため</p>
                                        <p>3. 戦争中に栄養のある食事を摂るため</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">2. 貧しい子どもたちへの支援のため</span>」でした。実は、給食は食事に困っている子どものために始まったんですよ。</p>
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第2問：牛乳とカルシウム</span>
                                    <p class="font-bold text-red-700">問題です！体に入った牛乳のカルシウムが、私たちの<span class="font-bold">骨になるために必要な栄養素</span>はなんでしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. ビタミンA</p>
                                        <p>2. ビタミンC</p>
                                        <p>3. ビタミンD</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">3. ビタミンD</span>」でした。カルシウムは、ビタミンDと一緒じゃないと、骨にうまく吸収されないんですよ。太陽の光を浴びたり、魚を食べたりして、ビタミンDも一緒に摂りましょうね！</p>
                                </div>
                            </div>

                            <!-- Q3 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第3問：世界の給食</span>
                                    <p class="font-bold text-red-700">問題です！世界の国の中で、給食の時間が一番長いのはどこでしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. イタリア</p>
                                        <p>2. フランス</p>
                                        <p>3. スウェーデン</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">2. フランス</span>」でした。フランスは昼食をとても大切にするため、休憩時間も含めて<span class="font-bold">2時間</span>も取る学校があるそうですよ。</p>
                                </div>
                            </div>

                            <div class="border-t border-yellow-200 pt-4">
                                <p class="font-bold text-gray-800 mb-1">放送委員</p>
                                <p>以上、楽しい雑学クイズでした。給食の歴史や栄養の秘密を知ると、食べるのがもっと楽しくなりますね！</p>
                            </div>
                        </div>
                    </section>

                    <!-- Music Transition -->
                    <section class="border-l-4 border-blue-500 pl-4 pt-4 mb-8">
                        <h3 class="text-sm font-bold text-blue-500 uppercase mb-2 tracking-wider">12:44頃 〜 曲紹介</h3>
                        <div class="space-y-4 reading-text">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>それでは、続いての曲を流します。</p>
                                <p class="mt-2">次は「怪獣の花唄」、そして「水平線」を続けて流します。**ぜひお楽しみください！**</p>
                            </div>
                        </div>
                    </section>

                    <!-- Ending -->
                    <section class="border-l-4 border-green-500 pl-4 pt-4">
                        <h3 class="text-sm font-bold text-green-500 uppercase mb-2 tracking-wider">12:48頃 〜 エンディング</h3>
                        <div class="bg-green-50 p-4 rounded-lg reading-text">
                            <p class="font-bold text-gray-700 mb-1">放送委員</p>
                            <p>もう、昼休みのお時間がすぎてしまいました。<br>
                            お楽しみいただけましたか？それでは、今日はこのへんで。</p>
                            <p class="mt-2">今日の放送の担当は、5年の（名前）と（名前）でした！<br>
                            また明日もお会いしましょう！さようなら！</p>
                        </div>
                    </section>
                </div>
            </div>

            <!-- =========================================
                 放送番号 2 の内容 (学校のふしぎ・歴史雑学) - 12/15(月)に更新
            ========================================== -->
            <div id="broadcast2" class="script-content hidden fade-in">
                <div class="flex items-center justify-between bg-purple-50 p-3 rounded border-l-4 border-purple-500 mb-6">
                    <h2 class="font-bold text-purple-700">放送日：12月15日（月）</h2>
                    <span class="text-sm text-purple-600">担当：5年 放送委員</span>
                </div>

                <!-- 編集可能なエリア -->
                <div id="editable-broadcast2" contenteditable="false" class="editable-script">
                    <!-- Opening -->
                    <section class="border-l-4 border-purple-500 pl-4 mb-8">
                        <h3 class="text-sm font-bold text-purple-500 uppercase mb-2 tracking-wider">12:35 オープニング</h3>
                        <div class="space-y-4 reading-text">
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>全・宝仙小の皆さん、こんにちは！<br>
                                さあ、始まりました！「Lunchtime music」のお時間です！<br>
                                この番組は、皆さんの毎日がさらに楽しくなるように発信する宝仙小ラジオ番組です。</p>
                            </div>
                            <div class="bg-gray-50 p-2 rounded border border-gray-200 text-sm text-gray-600 flex items-center gap-2">
                                <span class="bg-gray-200 px-2 py-0.5 rounded text-xs font-bold">動作</span>
                                CD音量を下げ、BGMとして流す
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>さて「Lunchtime music」始まっていますよ。<br>
                                この番組は、『給食の時間がさらに楽しくなるように』放送委員会がお送りします。</p>
                                <p class="mt-2">それではまず、ジブリ、そして「エジソン」を続けて放送します。**ぜひお楽しみください！**</p>
                            </div>
                        </div>
                    </section>

                    <!-- Pre-Trivia Music Block -->
                    <section class="border-l-4 border-gray-400 pl-4 opacity-70 hover:opacity-100 transition mb-8">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-2 tracking-wider">放送中 (12:35 - 12:44頃)</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 bg-gray-50 p-3 rounded">
                            <li>♪ ジブリ</li>
                            <li class="font-bold text-purple-600">♪ エジソン（1曲目）</li>
                        </ul>
                    </section>

                    <!-- Trivia Section 2 (学校のふしぎ・歴史雑学) -->
                    <section class="border-4 border-yellow-400 rounded-xl overflow-hidden shadow-sm relative mb-8">
                        <div class="bg-yellow-400 text-black font-bold py-2 px-4 flex justify-between items-center">
                            <span>★ ここから「ですます調」モード（敬語なし）</span>
                            <span class="text-xs bg-white text-yellow-800 px-2 py-1 rounded">12:44頃〜</span>
                        </div>
                        <div class="p-6 bg-yellow-50 space-y-6 reading-text">
                            <div>
                                <p class="font-bold text-gray-800 mb-1">放送委員</p>
                                <p class="text-sm text-gray-500 mb-2">（曲「エジソン」終了後、少し間を空けて）</p>
                                <p class="font-bold text-lg">
                                    さあ、ここからは知って楽しい豆知識！<span class="font-bold text-yellow-800">「ランチタイム雑学」</span>のお時間です！<br>
                                    今回のテーマは、<span class="font-bold text-red-700">「学校のふしぎ」</span>です。<br>
                                    さっそく、皆さんが毎日いる学校の、ちょっと不思議な歴史のクイズに挑戦してみましょう！
                                </p>
                            </div>

                            <!-- Q1 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第1問：制服の歴史</span>
                                    <p class="font-bold text-red-700">問題です！日本の小学校で、初めて制服が採用されたのはいつ頃でしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. 大正時代</p>
                                        <p>2. 江戸時代</p>
                                        <p>3. 明治時代</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">3. 明治時代</span>」でした。当時の日本では、服装の乱れを防ぐ目的で導入されたんですよ。</p>
                                </div>
                            </div>

                            <!-- Q2 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第2問：黒板の色</span>
                                    <p class="font-bold text-red-700">問題です！黒板はどうして黒色ではなく「深い緑色」をしているのでしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. 視力の低下を防ぐため</p>
                                        <p>2. 目が疲れにくい色だから</p>
                                        <p>3. 緑色の方が安く作れるから</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">2. 目が疲れにくい色だから</span>」でした。長時間見ていても目が疲れにくい色が選ばれているんですね。</p>
                                </div>
                            </div>

                            <!-- Q3 -->
                            <div class="space-y-4 border-t border-yellow-200 pt-4">
                                <div>
                                    <span class="inline-block bg-white border border-yellow-300 rounded px-2 py-0.5 text-xs font-bold text-yellow-700 mb-1">第3問：ランドセル</span>
                                    <p class="font-bold text-red-700">問題です！ランドセルのあの四角い形は、昔のあるものに似せて作られたと言われています。それは何でしょうか？</p>
                                    <div class="mt-2 pl-4 text-gray-700">
                                        <p>1. お弁当箱</p>
                                        <p>2. 軍隊のリュックサック（背のう）</p>
                                        <p>3. 辞書を入れる箱</p>
                                    </div>
                                    <p class="mt-3 font-bold text-gray-800">考える時間は、5秒間です。</p>
                                </div>
                                <p class="text-sm text-gray-500 mb-2 mt-2">（考える時間：5秒）</p>
                                <div class="bg-yellow-100 p-3 rounded">
                                    <p class="font-bold text-yellow-800 mb-1">正解発表！</p>
                                    <p>正解は、「<span class="font-bold text-yellow-900">2. 軍隊のリュックサック（背のう）</span>」でした。軍隊で使われていた四角いリュックサックを参考に、丈夫な革で作られたのが始まりなんですよ。</p>
                                </div>
                            </div>

                            <div class="border-t border-yellow-200 pt-4">
                                <p class="font-bold text-gray-800 mb-1">放送委員</p>
                                <p>以上、楽しい雑学クイズでした。意外な歴史を知ると、学校生活がもっと楽しくなりますね！</p>
                            </div>
                        </div>
                    </section>

                    <!-- Music Transition -->
                    <section class="border-l-4 border-purple-500 pl-4 pt-4 mb-8">
                        <h3 class="text-sm font-bold text-purple-500 uppercase mb-2 tracking-wider">12:45頃 〜 曲紹介</h3>
                        <div class="space-y-4 reading-text">
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>それでは、続いての曲を流します。</p>
                                <p class="mt-2">次は「水平線」、そして「パプリカ」を続けて流します。**ぜひお楽しみください！**</p>
                            </div>
                        </div>
                    </section>

                    <!-- Ending -->
                    <section class="border-l-4 border-green-500 pl-4 pt-4">
                        <h3 class="text-sm font-bold text-green-500 uppercase mb-2 tracking-wider">12:48頃 〜 エンディング</h3>
                        <div class="bg-green-50 p-4 rounded-lg reading-text">
                            <p class="font-bold text-gray-700 mb-1">放送委員</p>
                            <p>もう、昼休みのお時間がすぎてしまいました。<br>
                            お楽しみいただけましたか？それでは、今日はこのへんで。</p>
                            <p class="mt-2">今日の放送の担当は、5年の（名前）と（名前）でした！<br>
                            また明日もお会いしましょう！さようなら！</p>
                        </div>
                    </section>
                </div>
            </div>

            <!-- =========================================
                 放送番号 3 の内容 (雑学なし・家カフェ)
            ========================================== -->
            <div id="broadcast3" class="script-content hidden fade-in">
                <div class="flex items-center justify-between bg-green-50 p-3 rounded border-l-4 border-green-500 mb-6">
                    <h2 class="font-bold text-green-700">放送日：未定</h2>
                    <span class="text-sm text-green-600">担当：5年 放送委員</span>
                </div>

                <!-- 編集可能なエリア -->
                <div id="editable-broadcast3" contenteditable="false" class="editable-script">
                    <!-- Opening -->
                    <section class="border-l-4 border-green-500 pl-4 mb-8">
                        <h3 class="text-sm font-bold text-green-500 uppercase mb-2 tracking-wider">12:35 オープニング</h3>
                        <div class="space-y-4 reading-text">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>全・宝仙小の皆さん、こんにちは！<br>
                                さあ、始まりました！「Lunchtime music」のお時間です！<br>
                                この番組は、皆さんの毎日がさらに楽しくなるように発信する宝仙小ラジオ番組です。</p>
                            </div>
                            <div class="bg-gray-50 p-2 rounded border border-gray-200 text-sm text-gray-600 flex items-center gap-2">
                                <span class="bg-gray-200 px-2 py-0.5 rounded text-xs font-bold">動作</span>
                                CD音量を下げ、BGMとして流す
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="font-bold text-gray-700 mb-1">放送委員</p>
                                <p>さて「Lunchtime music」始まっていますよ。<br>
                                この番組は、『給食の時間がさらに楽しくなるように』放送委員会がお送りします。</p>
                                <p class="mt-2">それでは、今日は<span class="font-bold text-green-700">「家カフェ」</span>を流します。ゆっくりとした時間も**ぜひお楽しみください！**</p>
                            </div>
                        </div>
                    </section>

                    <!-- Music Only Block -->
                    <section class="border-l-4 border-gray-400 pl-4 opacity-70 hover:opacity-100 transition mt-6 mb-6">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-2 tracking-wider">放送中 (12:36 - 12:48頃)</h3>
                        <div class="bg-gray-50 p-6 rounded text-center border border-gray-200">
                            <p class="text-xl font-bold text-gray-700 mb-2">♪ 家カフェ</p>
                            <p class="text-sm text-gray-500">（雑学はありません。音楽をぜひお楽しみください）</p>
                        </div>
                    </section>

                    <!-- Ending -->
                    <section class="border-l-4 border-green-500 pl-4 pt-4">
                        <h3 class="text-sm font-bold text-green-500 uppercase mb-2 tracking-wider">12:48頃 〜 エンディング</h3>
                        <div class="bg-green-50 p-4 rounded-lg reading-text">
                            <p class="font-bold text-gray-700 mb-1">放送委員</p>
                            <p>もう、昼休みのお時間がすぎてしまいました。<br>
                            お楽しみいただけましたか？それでは、今日はこのへんで。</p>
                            <p class="mt-2">今日の放送の担当は、5年の（名前）と（名前）でした！<br>
                            また明日もお会いしましょう！さようなら！</p>
                        </div>
                    </section>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Local Storage のキー（アプリ全体で統一）
        const STORAGE_KEY = 'lunchtime_broadcast_scripts';
        // 初期編集モード (最初は閲覧/ロック状態)
        let isEditMode = false; 

        document.addEventListener('DOMContentLoaded', () => {
            // 1. 保存されたデータを読み込む
            loadScripts();
            // 2. 初期表示は放送1
            switchTab('broadcast1');
            // 3. 編集可能エリアにイベントリスナーを設定し、変更を保存
            setupAutoSave();
            // 4. 初期ボタンの状態を設定
            updateEditButton();
        });

        /**
         * LocalStorageから台本データを読み込み、コンテンツに反映する
         */
        function loadScripts() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    const scripts = JSON.parse(savedData);
                    for (const id in scripts) {
                        const element = document.getElementById(id);
                        if (element) {
                            element.innerHTML = scripts[id];
                        }
                    }
                    alertMessage('保存された台本を読み込みました。', 'save');
                } catch (e) {
                    console.error('保存データの解析に失敗しました。', e);
                }
            } else {
                 alertMessage('初めての読み込みです。', 'info');
            }
        }

        /**
         * 編集可能エリアに input イベントを設定し、変更があったら LocalStorage に保存する
         */
        function setupAutoSave() {
            document.querySelectorAll('.editable-script').forEach(el => {
                el.addEventListener('input', debounce(saveScripts, 1000));
            });
        }

        /**
         * 現在の台本の内容を LocalStorage に保存する
         */
        function saveScripts() {
            const scripts = {};
            document.querySelectorAll('.editable-script').forEach(el => {
                scripts[el.id] = el.innerHTML;
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(scripts));
            alertMessage('台本を自動保存しました。', 'success');
        }

        /**
         * デバウンス関数（連続した入力を制限し、最後の入力から一定時間後に実行）
         */
        function debounce(func, delay) {
            let timeout;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }
        
        /**
         * 編集モードを切り替える
         */
        function toggleEditMode() {
            isEditMode = !isEditMode;
            updateEditButton();
            document.querySelectorAll('.editable-script').forEach(el => {
                // 編集モードを切り替える (true/false)
                el.contentEditable = isEditMode;
            });

            if (isEditMode) {
                alertMessage('編集モードになりました。文章をタップして修正できます。', 'edit');
            } else {
                alertMessage('閲覧モードになりました。誤操作を防げます。', 'lock');
            }
        }

        /**
         * 編集ボタンのアイコンとテキストを更新する
         */
        function updateEditButton() {
            const btn = document.getElementById('edit-toggle-btn');
            const statusText = document.getElementById('edit-status-text');
            const penIcon = document.getElementById('pen-icon');
            const lockIcon = document.getElementById('lock-icon');

            if (isEditMode) {
                // 編集モード（ペン表示）
                statusText.textContent = 'ロックする';
                btn.classList.remove('bg-yellow-500');
                btn.classList.add('bg-red-500', 'text-white');
                penIcon.classList.add('hidden');
                lockIcon.classList.remove('hidden');
            } else {
                // 閲覧モード（鍵表示）
                statusText.textContent = '編集する';
                btn.classList.remove('bg-red-500', 'text-white');
                btn.classList.add('bg-yellow-500');
                penIcon.classList.remove('hidden');
                lockIcon.classList.add('hidden');
            }
        }


        let activeTabId = 'broadcast1';

        function switchTab(tabId) {
            // 1. 現在のアクティブなタブを更新
            activeTabId = tabId;

            // 2. すべてのコンテンツを非表示にする
            document.querySelectorAll('.script-content').forEach(el => {
                el.classList.add('hidden');
            });
            // 選択されたコンテンツを表示する
            const activeContent = document.getElementById(tabId);
            if(activeContent) {
                activeContent.classList.remove('hidden');
            }

            // 3. すべてのボタンのスタイルをリセットする
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-white', 'text-blue-600', 'border-blue-600', 'shadow-sm', 'text-purple-600', 'border-purple-600', 'text-green-600', 'border-green-600');
                el.classList.add('bg-gray-100', 'text-gray-500', 'border-transparent');
            });

            // 4. 選択されたボタンにアクティブスタイルを適用する
            const activeBtn = document.getElementById('btn-' + tabId);
            if(activeBtn) {
                // タブIDに基づいてアクティブな色を決定
                let activeColor = 'blue-600';
                if (tabId === 'broadcast2') activeColor = 'purple-600';
                if (tabId === 'broadcast3') activeColor = 'green-600';

                activeBtn.classList.remove('bg-gray-100', 'text-gray-500', 'border-transparent');
                activeBtn.classList.add('bg-white', `text-${activeColor}`, `border-${activeColor}`, 'shadow-sm');
            }
        }

        /**
         * 現在表示されている台本の内容をクリップボードにコピーする
         */
        function copyScript() {
            // 現在表示中のタブIDを取得
            const editableContent = document.getElementById('editable-' + activeTabId);

            if (!editableContent) {
                alertMessage('コピーする台本がありません。', 'error');
                return;
            }

            // テキスト内容を抽出 (HTMLタグを除去して純粋な台本テキストを抽出)
            let textToCopy = editableContent.innerText;

            // クリップボードにコピー
            const tempInput = document.createElement('textarea');
            tempInput.value = textToCopy.trim();
            document.body.appendChild(tempInput);
            tempInput.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alertMessage('コピー成功！台本がクリップボードに保存されました。', 'success');
                } else {
                    alertMessage('コピーに失敗しました。手動でコピーしてください。', 'error');
                }
            } catch (err) {
                alertMessage('コピーに失敗しました。手動でコピーしてください。', 'error');
            } finally {
                // 一時的な要素を削除
                document.body.removeChild(tempInput);
            }
        }

        /**
         * alert()の代わりに使うカスタムメッセージ表示関数
         */
        function alertMessage(message, type = 'info') {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = message;

            // スタイルを設定
            let bgColor = '#10b981'; // success
            if (type === 'error') bgColor = '#ef4444';
            if (type === 'info') bgColor = '#3b82f6';
            if (type === 'save') bgColor = '#059669'; // darker green
            if (type === 'edit') bgColor = '#f59e0b'; // yellow
            if (type === 'lock') bgColor = '#dc2626'; // red

            msgBox.style.backgroundColor = bgColor;

            // 既存の非表示クラスを削除し、表示・不透明にする
            msgBox.classList.remove('hidden', 'opacity-0');
            msgBox.classList.add('opacity-100');

            setTimeout(() => {
                // フェードアウト開始
                msgBox.classList.remove('opacity-100');
                msgBox.classList.add('opacity-0');
                // フェードアウト後、非表示クラスを追加
                setTimeout(() => msgBox.classList.add('hidden'), 300);
            }, 3000);
        }
    </script>
</body>
</html>
